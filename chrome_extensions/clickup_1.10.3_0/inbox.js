(()=>{"use strict";var e={8139:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.onCommand=t.matrix=t.region=t.save=t.capture=void 0;var n=[],i=[],o=1,c=document.createElement("canvas");function r(e){return void 0===e&&(e=null),new Promise((function(t,n){chrome&&chrome.tabs&&chrome.tabs.captureVisibleTab?chrome.tabs.captureVisibleTab(null,{format:"png"},(function(i){if(!e)return t(i);var o=e.left*e.devicePixelRatio+1,c=e.top*e.devicePixelRatio+1,r=e.width*e.devicePixelRatio-2,a=e.height*e.devicePixelRatio-2,l=document.createElement("canvas"),s=l.getContext("2d"),u=new Image;u.onload=function(){l.width=r||u.width,l.height=a||u.height,r&&a?s.drawImage(u,o,c,r,a,0,0,r,a):s.drawImage(u,0,0),t(l.toDataURL())},u.onerror=function(e){return n(e)},u.src=i})):chrome.runtime.sendMessage({captureVisibleTab:!0},(function(i){if(!e)return t(i);var o=e.left*e.devicePixelRatio+1,c=e.top*e.devicePixelRatio+1,r=e.width*e.devicePixelRatio-2,a=e.height*e.devicePixelRatio-2,l=document.createElement("canvas"),s=l.getContext("2d"),u=new Image;u.onload=function(){l.width=r||u.width,l.height=a||u.height,r&&a?s.drawImage(u,o,c,r,a,0,0,r,a):s.drawImage(u,0,0),t(l.toDataURL())},u.onerror=function(e){return n(e)},u.src=i}))}))}function a(e,t){return new Promise((function(n,i){chrome.storage.local.get({delay:500,offset:50},(function(o){var c=[],a=[],l=1,s=document.createElement("canvas"),u=s.getContext("2d");function d(){if(a.length){var e=a.shift(),t=new Image;t.onload=function(){u.drawImage(t,0,0,t.width*l,t.height*l,e.x*l,e.y*l,t.width*l,t.height*l),d()},t.onerror=function(e){return i(e)},t.src=e.dataUrl}else n(s.toDataURL())}var m=t.scrollWidth,g=t.scrollHeight,h=t.innerWidth,f=t.innerHeight;l=t.dpr,s.width=m*l,s.height=g*l;for(var p=0;p<m-o.offset;p+=h-o.offset)for(var y=0;y<g-o.offset;y+=f-o.offset)c.push([p,y]);!function n(){if(c.length){var i=c.shift(),l=i[0],s=i[1];chrome.scripting.executeScript({target:{tabId:e},func:function(){return document.querySelector(t.el).scroll(l,s),[document.querySelector(t.el).scrollLeft,document.querySelector(t.el).scrollTop]}},(function(e){var i=e[0].result,c=i[0],l=i[1];window.setTimeout((function(){r({left:t.left,top:t.top,width:t.innerWidth,height:t.innerHeight,devicePixelRatio:t.dpr}).then((function(e){a.push({x:c,y:l,dataUrl:e}),n()}))}),o.delay)}))}else d()}()}))}))}function l(e){return new Promise((function(t,a){chrome.storage.local.get({delay:500,offset:50},(function(l){function s(){if(i.length){var n=i.shift(),r=new Image;r.onload=function(){c.getContext("2d").drawImage(r,0,0,r.width*o,r.height*o,n.x1*o,n.y1*o,r.width*o,r.height*o),s()},r.onerror=function(e){return a(e)},r.src=n.dataUrl}else t(c.toDataURL()),chrome.scripting.executeScript({target:{tabId:e},func:function(){setTimeout((function(){document.getElementById("clickup-chrome-extension-frame-box")&&(document.getElementById("clickup-chrome-extension-frame-box").style.display="block")}),500)}})}function u(){if(n.length){var t=n.shift(),o=t[0],c=t[1];chrome.scripting.executeScript({target:{tabId:e},func:function(){return window.scroll(o,c),[document.body.scrollLeft||document.documentElement.scrollLeft,document.body.scrollTop||document.documentElement.scrollTop]}},(function(e){var t=e[0].result,n=t[0],o=t[1];window.setTimeout((function(){r().then((function(e){i.push({x1:n,y1:o,dataUrl:e}),u()}))}),l.delay)}))}else s()}chrome.scripting.executeScript({target:{tabId:e},func:function(){return[document.body.scrollWidth,document.body.scrollHeight,document.documentElement.clientWidth,document.documentElement.clientHeight,window.devicePixelRatio]}},(function(e){var t=e[0].result,i=t[0],r=t[1],a=t[2],s=t[3];o=e[0][4],c.width=i*o,c.height=r*o;for(var d=0;d<i-l.offset;d+=a-l.offset)for(var m=0;m<r-l.offset;m+=s-l.offset)n.push([d,m]);u()}))}))}))}t.capture=r,t.save=function(e,t){chrome.storage.local.get({timestamp:!0,saveAs:!1},(function(n){if(n.timestamp){var i=new Date;t=t+=" "+i.toLocaleDateString()+" "+i.toLocaleTimeString()}t=t.replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,"-"),t+=".png",fetch(e).then((function(e){return e.blob()})).then((function(e){var i=URL.createObjectURL(e);chrome.downloads.download({url:i,filename:t,saveAs:n.saveAs},(function(){if(chrome.runtime.lastError){var e=document.createElement("a");e.href=i,e.setAttribute("download",t),e.dispatchEvent(new MouseEvent("click"))}}))}))}))},t.region=a,t.matrix=l,t.onCommand=function(e,t,n){if(void 0===n&&(n=null),"capture-visual"===e)return new Promise((function(e){t.id?chrome.scripting.executeScript({target:{tabId:t.id},func:function(){document.getElementById("clickup-chrome-extension-frame-box")&&(document.getElementById("clickup-chrome-extension-frame-box").style.display="none")}},(function(){setTimeout((function(){e(r())}),100),chrome.scripting.executeScript({target:{tabId:t.id},func:function(){setTimeout((function(){document.getElementById("clickup-chrome-extension-frame-box")&&(document.getElementById("clickup-chrome-extension-frame-box").style.display="block")}),500)}})})):e(r())}));if("capture-portion"===e)chrome.scripting.insertCSS({target:{tabId:t.id},files:["inject/inject.css"]},(function(){chrome.scripting.executeScript({target:{tabId:t.id},files:["inject/inject.js"]})}));else{if("capture-entire"===e)return new Promise((function(e){chrome.scripting.executeScript({target:{tabId:t.id},func:function(){document.getElementById("clickup-chrome-extension-frame-box")&&(document.getElementById("clickup-chrome-extension-frame-box").style.display="none")}},(function(n){setTimeout((function(){e(l(t.id))}),100)}))}));if("region"===e)return new Promise((function(e){chrome.scripting.executeScript({target:{tabId:t.id},func:function(){document.getElementById("clickup-chrome-extension-frame-box")&&(document.getElementById("clickup-chrome-extension-frame-box").style.display="none")}},(function(){setTimeout((function(){e(a(t.id,n))}),100)}))}));if(n)return r(n)}return Promise.resolve(!1)}}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var c=t[i]={exports:{}};return e[i](c,c.exports,n),c.exports}(()=>{var e=n(8139);window.isGmailInjected=!0;var t="inbox.google.com"===document.location.host;function i(n){n.getThreadIDAsync().then((function(i){if(i){var o,c,r=(o=window.location.href,(c=/^https\:\/\/\w+\.google\.com\/(u\/\d\/)/.exec(o))?c[1]:"");document.createElement("a").href="https://mail.google.com/mail/"+r+"#all/"+i;var a=document.createElement("div");a.className="cu-gmail-container",a.setAttribute("data-cu-thread-id",i);var l=n.addNoticeBar().el;l.style.display="none",l.style.background="none",l.style.margin="0px 0px 0 10px",l.style.padding="5px",l.appendChild(a),n.getMessageViewsAll().forEach((function(o){var c=function(o){var c=o.getBodyElement(),r=c.parentElement,a=r.parentElement.parentElement.parentElement.parentElement.parentElement;if(t){if(r.querySelector(".b5")&&!r.querySelector(".cu-chrome-extension-gmail.cu-screenshot__action-btn")){(s=document.createElement("button")).title="Add To ClickUp",s.innerHTML='<img src="'+chrome.runtime.getURL("assets/logo-color.png")+'" width="22"/>',s.className="cu-chrome-extension-gmail cu-screenshot__action-btn",s.style.marginTop="-7px",s.style.float="left";var l=i;s.onclick=function(e){chrome.storage.local.set({url:"/email"}),e.preventDefault(),e.stopImmediatePropagation(),document.getElementById("clickup-chrome-extension-frame-box")&&document.getElementById("clickup-chrome-extension-frame-box").remove(),c.querySelector(".mg")&&c.getBoundingClientRect().height<30&&c.querySelector(".mg").click(),r.classList.add("pulse"),setTimeout((function(){r.classList.remove("pulse")}),500),window.innerHeight<c.getBoundingClientRect().height+c.getBoundingClientRect().top&&(a.querySelector(".bJ.s2").style.display="none",a.querySelector(".vl").style.display="none",document.querySelector(".nPQzwd.iP").style.display="none",window.scroll(0,document.scrollingElement.scrollTop+c.getBoundingClientRect().top-document.querySelector(".hn").getBoundingClientRect().height));var i=[];setTimeout((function(){chrome.runtime.sendMessage({method:"captured",left:c.getBoundingClientRect().left,top:c.getBoundingClientRect().top,width:c.getBoundingClientRect().width,height:(c.getBoundingClientRect().height>window.innerHeight?window.innerHeight:c.getBoundingClientRect().height)-document.querySelector(".hn").getBoundingClientRect().height,devicePixelRatio:window.devicePixelRatio,title:document.title,ext:!0,gmail:{html:c.innerHTML,data:{email:document.querySelector("[data-inboxsdk-user-email-address]").getAttribute("data-inboxsdk-user-email-address"),id:l,subject:n.getSubject(),from:o.getSender().emailAddress,attachments:i,msg:l,client:t?"inbox":"gmail"}}},(function(e){setTimeout((function(){a.querySelector(".bJ.s2").style.display="block",a.querySelector(".vl").style.display="block",document.querySelector(".nPQzwd.iP").style.display="block"}),500)}))}),500)},r.querySelector(".hOfgWc.s2").append(s),chrome.runtime.sendMessage({getAttachedTasks:l},(function(e){}))}}else if((a=a.querySelector("[data-message-id]")).getAttribute("data-message-id")&&!a.querySelector(".cu-chrome-extension-gmail.cu-screenshot__action-btn")){var s;(s=document.createElement("button")).title="Add To ClickUp",s.innerHTML='<img src="'+chrome.runtime.getURL("assets/logo-color.png")+'" width="22"/>',s.className="cu-chrome-extension-gmail cu-screenshot__action-btn";var u=i;s.onclick=function(i){chrome.storage.local.set({url:"/email"}),i.preventDefault(),i.stopImmediatePropagation(),document.getElementById("clickup-chrome-extension-frame-box")&&document.getElementById("clickup-chrome-extension-frame-box").remove();var c=a.querySelector(".a3s");a.querySelector(".ajR")&&c.getBoundingClientRect().height<65&&a.querySelector(".ajR").click();var r=document.querySelector(".Tm.aeJ");null===r&&(r=document.querySelector(".nH.age.apN")),null===r&&(r=document.querySelector(".Nu.S3.aZ6")),null===r&&(r=a),r.classList.add("pulse"),setTimeout((function(){document.querySelector(".pulse")&&document.querySelector(".pulse").classList.remove("pulse")}),2e3),c.style.padding="5px";var l=a.querySelector(".ii.gt").parentNode.querySelectorAll("[download_url]"),s=[];l&&l.forEach((function(e){s.push(e.getAttribute("download_url"))}));var d=new Promise((function(e,t){var n=document.querySelectorAll(".a3s img[src]");if(n&&n.length){var i=n.length;n.forEach((function(t){t.src&&t.src.startsWith("https://mail.google.com/mail/u")?function(e){return new Promise((function(t,n){var i=new XMLHttpRequest;i.onload=function(){var e=new FileReader;e.onloadend=function(){t(e.result)},e.readAsDataURL(i.response)},i.onerror=n,i.open("GET",e),i.responseType="blob",i.send()}))}(t.src).then((function(n){t.src=n,0==--i&&e()})).catch((function(){0==--i&&e()})):0==--i&&e()}))}else e()}));d.then((function(){setTimeout((function(){var i=c.getBoundingClientRect().width,l=c.clientHeight>r.clientHeight?r.clientHeight:c.clientHeight;r&&r.clientWidth&&c.getBoundingClientRect().width>r.clientWidth&&(i=r.clientWidth-70),chrome.runtime.sendMessage({getActiveTab:!0},(function(d){(0,e.onCommand)(void 0,d,{method:"captured",left:c.getBoundingClientRect().left,top:c.getBoundingClientRect().top<r.getBoundingClientRect().top?r.getBoundingClientRect().top:c.getBoundingClientRect().top,width:i,height:l-200,devicePixelRatio:window.devicePixelRatio,title:document.title,ext:!0}).then((function(e){chrome.storage.local.set({screenshotTime:(new Date).getTime(),gmail:JSON.stringify({thumbnail:e,html:a.querySelector(".a3s").innerHTML,data:{email:document.querySelector("[data-inboxsdk-user-email-address]").getAttribute("data-inboxsdk-user-email-address"),id:u,subject:n.getSubject(),from:o.getSender().emailAddress,attachments:s,msg:a.getAttribute("data-message-id").match(/-/)?document.querySelector("[data-legacy-message-id]").getAttribute("data-legacy-message-id"):a.getAttribute("data-message-id"),client:t?"inbox":"gmail"}})},(function(){chrome.runtime.sendMessage({method:"captured",ext:!0},(function(e){}))}))}))}))}),500)}))},a.querySelector(".gE.iv").appendChild(s),chrome.runtime.sendMessage({getAttachedTasks:u},(function(e){}))}};o.on("load",(function(e){setTimeout((function(){c(e.messageView)}),500)})),o.isLoaded()&&setTimeout((function(){c(o)}),500)}))}})).catch((function(){console.log("[cu-inbox] => error:",arguments)}))}chrome.runtime.onMessage.addListener((function(e,t,n){if(e&&e.attachedTasks&&e.attachedTasks&&e.attachedTasks.tasks&&e.attachedTasks.id){var i=document.querySelector('[data-cu-thread-id="'+e.attachedTasks.id+'"]');i&&(e.attachedTasks.tasks.forEach((function(e){if(e&&e.id&&e.name&&e.url){var t=document.createElement("div");t.innerHTML='<a class="cu-gmail-attached-task" data-cu-task-id="'+e.id+'" href="'+e.url+'" target="_blank"> <img src="'+chrome.runtime.getURL("assets/logo-color.png")+'" width="22"/> <span class="cu-gmail-attached-task__name">'+e.name+"</span></a>",i&&(i.querySelector('[data-cu-task-id="'+e.id+'"]')&&i.querySelector('[data-cu-task-id="'+e.id+'"]').remove(),i.appendChild(t))}})),i.parentElement.style.display="block")}n(!0)}));var o=[];function c(e){e.getThreadIDIfStableAsync().then((function(t){t&&(o[t]=e)}))}setInterval((function(){if(Object.keys(o).length){var e=Object.assign({},o);o=[],chrome.runtime.sendMessage({getBulkAttachedTasks:Object.keys(e)},(function(t){var n=t.threads,i=t.iconUrl;n&&n.length&&n.forEach((function(t){t.tasks&&t.tasks.length&&t.tasks.forEach((function(n){e&&t.id&&e[t.id]&&n.id&&e[t.id].addLabel({title:"#"+n.id,iconUrl:i})}))}))}))}}),1e3),InboxSDK.load(2,"sdk_clickup_a07824d634",{}).then((function(e){setTimeout((function(){e.Conversations.registerThreadViewHandler(i),e.Lists.registerThreadRowViewHandler(c)}),100)}))})()})();